<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Welcome to the web interface of DyCon Toolbox, the computational platform developed within the <a href='https://cmc.deusto.eus/dycon/' target='_blank'>ERC DyCon - Dynamic Control</a> project.">
	<link rel='shortcut icon' type='image/png' href='/DyCon-Blog/favicon.png' />

  <title>
    Movil control strategy for models with memory terms - DyCon Blog
    
  </title>

  <link rel="canonical" href="http://localhost:4000/DyCon-Blog/tutorial/wp05/P0011">

  <!-- Bootstrap Core CSS -->
  <link rel="stylesheet" href="http://localhost:4000/DyCon-Blog/css/bootstrap.min.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="http://localhost:4000/DyCon-Blog/css/clean-blog.css">

   <!-- Adjust Colors -->
  <link rel="stylesheet" href="http://localhost:4000/DyCon-Blog/colorscheme.css">

  <!-- Pygments Github CSS -->
  <link rel="stylesheet" href="http://localhost:4000/DyCon-Blog/css/syntax.css">


  <script src="http://localhost:4000/DyCon-Blog/lib/js/libgif.js "></script>
  <script src="http://localhost:4000/DyCon-Blog/lib/js/rubbable.js "></script>


  <!-- Google Fonts Raleway -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,700" rel="stylesheet">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
	<!-- MathJax -->
  <script type="text/x-mathjax-config">
	MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    },
		TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      },
      extensions: ["AMSmath.js", "AMSsymbols.js"],
      Macros:{
        norm: ["|| #1 ||",1],
        abs: ["| #1 |",1],
        hdots: "...",
        RR: "\\mathbb{R}",
        ffl: ["(d_x^2)^{#1}",1],
        ccs: "c_{1,s}",
        kernel: ["|x-y|^{#1}",1],
        ue: ["#1^{\\epsilon}",1]
      }
    },
    CommonHTML: {
      styles: {
        "@font-face /* vec */ ": {
          "font-family": "MJX-VEC",
          src: [
            "url(data:application/x-font-woff;charset=utf-8;base64,",
            "d09GRgABAAAAAARMAA0AAAAABiQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAAEMAAAABwA",
            "AAAccRGLqUdERUYAAAQMAAAAJAAAACgANAAmT1MvMgAAAaAAAABJAAAAYFc5gfFjbWFwAAACAAAA",
            "AEYAAAFKQxjlbWdhc3AAAAQEAAAACAAAAAj//wADZ2x5ZgAAAlQAAACUAAAAlIQU9HBoZWFkAAAB",
            "MAAAADAAAAA2C748e2hoZWEAAAFgAAAAHgAAACQFXQDqaG10eAAAAewAAAAUAAAAFAYvAE9sb2Nh",
            "AAACSAAAAAwAAAAMACgAcm1heHAAAAGAAAAAHQAAACAASQAmbmFtZQAAAugAAADxAAAB5uwlD0hw",
            "b3N0AAAD3AAAACgAAAA34M9aEXjaY2BkYGAA4uOfgq7G89t8ZeBmfgEUYbga+icNTssClVxnOgXk",
            "cjAwgUQBdqEMW3jaY2BkYGBu+feBgYHxCwMQMF5nYGRABawAcaQESgAAeNpjYGRgYGBlUGZgYgAB",
            "EMnIABJzAPMZAAZZAHAAAAB42mNgYSxn/MLAysDA1MW0h4GBoQdCMz5gMGRkAooysDEzwAAjECvA",
            "OAFprikMBxgUFCcxt/z7wMDA3MIoAFUDAwoMjACD8Qv5AAAAAfQAMgAAAAABTQAAAPoAAAH0AB14",
            "2mNgYGBmgGAZBkYGEHAB8hjBfBYGDSDNBqQZGZgYFBQn/f8P5IPp/4/vFUHVAwEjGwOcw8gEJJgY",
            "UAEjxIrhDACLGwmnAAAAAAAUABQAFAAUAEoAAgAyAAABwgIVAAMABwAAMxEhESUhESEyAZD+ogEs",
            "/tQCFf3rMgGxAAEAHQIEAdcCygAiAAABNDYzMhcWFxYXFhUUBgcGBw4DIyImNTQ3IycmNTQ3ISYB",
            "eQsJBwUFBQofCwYLKyACBwMGBAcNL6urDQ0BZxgCtggMBQQPJRQHCwkGBhYpAgkCAgsJEygBCQoH",
            "DSYAeNqVjrGKwkAURe/EGBBUrG12CishMrFQcDuLsAi26YMOmsIMxAh+hN8i+CF+gd+y4B3zttjC",
            "woHhncu7774HoI8rFP5eIKzQw5dwgAjfwi2McBEO6bkLtzHAr3CEnhrTqcKOpDasMCQ1HKCLWLiF",
            "HyyFQ3puwm1oPIQjDFXfR62Ro8YeK9YzMlhsqB0qtvJ6v8rPmd3Uzkv2tihwwoHCbosTa0pryYH0",
            "NbKjRWPB/z626Se8dsY/hSHPGeTKOnXVzuqF/reYOoln8dQk80+u9b0KR97rD9Rc4xdNXtVQI7PV",
            "sXClNiaZGGP0B+FPMN1KMAAAAHjaY2BiAIP/zQxGDNgAKxAzMjAxMDMycSUWFeWXF2WmZ5QAAGh5",
            "BhgAAAAB//8AAnjaY2BkYGDgA2IJBgUgycTAyMDMwAIkWcA8BgZGCAYACgIAWwAAAAEAAAAAxmW3",
            "ygAAAADVVeemAAAAANVV7Dg=) format('woff')"
          ].join('')
        },
        ".MJX-VEC": {
          "font-family": "MJX-VEC"
        }
      }
    }
  });
  MathJax.Hub.Register.StartupHook("CommonHTML Jax Ready", function () {
    var MML = MathJax.ElementJax.mml;
    var fixCombiningChar = MML.mo.prototype.CHTMLfixCombiningChar;
    MML.mo.Augment({
      CHTMLfixCombiningChar: function (node) {
        if (node.textContent === '\u20D7') {
          //
          //  Safari makes combining characters into non-combining ones when
          //  they don't have anything to combine with; replace \vec arrow
          //  with a non-combining one so all browsers get the same thing
          //
          node = node.firstChild;
          node.firstChild.nodeValue = "\u2192";
          node.className = "mjx-char MJX-VEC";
          node.style.marginLeft = "-.5em";
          node.style.paddingTop = ".45em";
        } else {
          fixCombiningChar.call(this,node);
        }
      }
    });
  });
	</script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
	<!--<script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js" type="text/javascript"></script>-->

    <!-- jQuery -->
	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

	<!-- Custom Theme JavaScript -->
  <script src="http://localhost:4000/DyCon-Blog/js/clean-blog.min.js "></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-128123935-3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-128123935-3');
  </script>
  <!-- End Google Analytics -->



  <!-- marKdown editor -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
  <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
</head>

<body>
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!-- <a class="navbar-brand" href="/DyCon-Blog/">
                 <img src="http://localhost:4000//DyCon-Blog//assets/logo_DyCon.png">
            </a> -->
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/DyCon-Blog/">Home</a>
                </li>
                
                
                    
                        
                    
                <li>
                    <a href="/DyCon-Blog/projects/posts">Documentation</a>
                </li>
                
                    
                <li>
                    <a href="/DyCon-Blog/projects/authors">Authors</a>
                </li>
                
                <li>
                        <a href="http://localhost:4000/DyCon-Blog/projects/search.byWP">Sitemap</a>
                </li>
                <li>
                        <a href="http://cmc.deusto.eus/">Chair of Computational Mathematics</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Post Header -->
<header class="intro-header">
  <div class="container" style="padding-top: 70px;">
    <div class="row">
      <div class="col-lg-10 col-md-10 col-md-offset-1">
        <div class="post-heading" style="padding: 0px 0"><h2><small class="light-grey"><a href="http://localhost:4000//DyCon-Blog/projects/posts">Work Packages</a>
            &#8827;<a href="http://localhost:4000//DyCon-Blog/workpackage/WP05">
            Models involving memory terms and hybrid PDE+ODE systems</a> &#8827;</small>
          </h2>
          <h1>Movil control strategy for models with memory terms</h1>
					<p class="meta">
            <div class="post-preview-authors ellipsis-one-line">
              Authors:
              
              
                
                <span style="text-decoration: none;" itemprop="author" itemscope itemtype="http://schema.org/Person">
                  <span itemprop="name">
                    <a style="text-decoration: none;" href="http://localhost:4000/DyCon-Blog/author/JesusO">Jesus Oroya</a>,
                  </span>
                </span>
              
                
                <span style="text-decoration: none;" itemprop="author" itemscope itemtype="http://schema.org/Person">
                  <span itemprop="name">
                    <a style="text-decoration: none;" href="http://localhost:4000/DyCon-Blog/author/UmbertoB">Umberto Biccari</a>
                  </span>
                </span>
              
              - 04 November 2019
            </div>
					</p>
        </div>
      </div>
		</div>
	</div>
</header>
<!-- Post Content -->
<style>
img {
	display:block;
	max-width:  100%;
	margin-left: auto;
	margin-right: auto;
}

@media only screen and (min-width: 1000px) {
img {
	-moz-transition:-moz-transform 0.5s ease-in; 
	-webkit-transition:-webkit-transform 0.5s ease-in; 
	-o-transition:-o-transform 0.5s ease-in;
}
img:active{
	-moz-transform:scale(1.2); 
	-webkit-transform:scale(1.2);
	-o-transform:scale(1.2);
}
}

@media only screen and (min-width: 1250px) {
img {
	-moz-transition:-moz-transform 0.5s ease-in; 
	-webkit-transition:-webkit-transform 0.5s ease-in; 
	-o-transition:-o-transform 0.5s ease-in;
}
img:active{
	-moz-transform:scale(1.5); 
	-webkit-transform:scale(1.5);
	-o-transform:scale(1.5);
}
}

@media only screen and (min-width: 1500px) {
img {
	-moz-transition:-moz-transform 0.5s ease-in; 
	-webkit-transition:-webkit-transform 0.5s ease-in; 
	-o-transition:-o-transform 0.5s ease-in;
}
img:active{
	-moz-transform:scale(2); 
	-webkit-transform:scale(2);
	-o-transform:scale(2);
}
}
</style>
<article>
  <div id="content" class="container">
    <div class="row">
      <div class="col-md-10 col-md-offset-1">
        
          
            <a href="http://localhost:4000/DyCon-Blog/assets/imgs/WP05/P0011/MovilControlBlog.zip""><i class="fa fa-download fa-lg"></i>Download Code</a>
          
        
        <p>En este tutorial enseñaremos como implentar la estrategía del control interíor móvil para la ecuación del calor. En el ejemplo típico de control interior en la ecuación del calor se pretende llevar al sistema desde un estado inicial, $u_0$ hasta el estado nulo en todo el espacio, $\Omega$. Para ello se define una subconjunto, $\omega \in \Omega$, donde el control, $f(x,t)$ puede actuar, es decir que para puntos, $x \notin \omega$, el control es cero. Este problema se puede escribir como:</p>

<script type="math/tex; mode=display">% <![CDATA[
\label{heatinterior}
\begin{equation}
\begin{cases}
\begin{matrix}
  \dot{u} = \Delta u + f(x,t) \chi_{\omega} \ & \ \textbf{x} \in \Omega & t \in [0,T] \\
  u(\textbf{x,t}) = 0    & \textbf{x} \in \partial \Omega  &  t \in [0,T] \\
  u(\textbf{x},0) = u_0  & \textbf{x} \in \Omega
\end{matrix}
\end{cases}
\end{equation} %]]></script>

<p>Donde $f$ es el control definido de solo en el subconjunto, $\omega \in \Omega$.</p>

<p>Es conocido que la controlabilidad de la ecuación del calor para todo tiempo esta asegurada, sin embargo en el caso de la ecuación del calor con términos de memoria este resultado no es válido. En este caso, eligiremos un problema con un término de memoria: $\int_0^t u(x,\tau)d\tau$. De esta forma el problema se puede escribir como:</p>

<script type="math/tex; mode=display">% <![CDATA[
\label{heatinterior_memory}
\begin{equation}
\begin{cases}
\begin{matrix}
  \dot{u} = \Delta u + f(x,t) \chi_{\omega} + \int_0^t u(x,\tau) d\tau \ & \ \textbf{x} \in \Omega & t \in [0,T] \\
  u(\textbf{x,t}) = 0    & \textbf{x} \in \partial \Omega  &  t \in [0,T] \\
  u(\textbf{x},0) = u_0  & \textbf{x} \in \Omega
\end{matrix}
\end{cases}
\end{equation} %]]></script>

<p>Este resultado se puede vercuenado aplicamos un control LQR sobre ambos sistemas. El mínimo del funcional LQR en el primer sistema (Equation \ref{heatinterior}) estabiliza la dínamica mientras que el mínimo del funcional en el segundo caso queda muy lejos del equilibrio.</p>

<hr />

<table>
    <tr>
        <th>
          <center>
            <video controls="" width="90%" src="http://localhost:4000/DyCon-Blog/assets/imgs/WP05/P0011/LQR_InteriorPoint_Heat_Equation.mp4"> </video>
          </center> 
        </th>
        <th>
          <center>
            <video controls="" width="90%" src="http://localhost:4000/DyCon-Blog/assets/imgs/WP05/P0011/LQR_InteriorPoint_Heat_Equation_with_memory.mp4"> </video>
          </center> 
        </th>
    </tr>
    <tr>
        <th>
          <center>
              <b>Video 1:</b> LQR in Heat equation (Equation \ref{heatinterior})
          </center> 
        </th>
        <th>
          <center>
              <b>Video 2:</b>  LQR in Heat equation with memory (Equation \ref{heatinterior_memory})
          </center> 
        </th>
    </tr> 
    <tr>
        <td colspan="2">
          <center>
              Podemos ver la evolucion de dos modelos, con un región de control, $\chi_{\omega}$, situado en la posición del elipsoide azul en la parte superior de la simulación. Podemos ver que el control LQR es eficaz para la ecuación del calor, sin embargo débil ante la presencia de término de memoria
          </center> 
        </td>
    </tr> 
</table>

<p>En el articulo [1], se menciona la idea del control móvil de ….
….
….</p>

<h2 id="definición-del-función-característica-dependiente-del-espacio">Definición del función característica dependiente del espacio</h2>

<p>Nuestro objetivo en esta sección es la construcción de una función que dado un punto, $\textbf{x} \in \Omega$, devuelva la función carácteristica correspondiente. Para el diseño de la función $\chi_{\omega(t)}$, se ha decidido que ni el tamaño, ni la orientación de $\omega$ cambia en el tiempo. De esta forma, una vez fijados el tamaño en las dos direcciones del espacio y la forma del subconjunto, obtenemos una función que solo depende de un punto $x\in \Omega$.</p>

<p>En esta simulación crearemos el subconjunto como un cuadrado que puede moverse en $\Omega$. este cuadrado se puede construir con una función $W(x)$ definida de la siguiente manera.</p>

<script type="math/tex; mode=display">W(x,a,b) = \Theta(x-a) + \Theta(x-b) \\  \{ a,b,x  \}\in \mathbb{R} \\ a>b \\</script>

<p>donde $\Theta(x)$ es la fución theta de heaviside. Dado que la función $\Theta(x)$, tiene una aproximación analítica, la función $W(x,a,b)$ puede ser suavizada, detalle que será de vital importancia para que se pueda calcular el gradiente de la restrición asociada a la dinámica cunado realizamos el problema de control óptimo.</p>

<p>Un representación gráfica de $W(x,a,b)$ permiter reconocer a esta función con valor unidad entre los valores $a$ y $b$ y nulo fuera de ellos.</p>

<table>
  <tr>
    <th>
      <img src="http://localhost:4000/DyCon-Blog/assets/imgs/WP05/P0011/WTHETA.png" width="65%" />
    </th>
  </tr>
  <tr>
    <th>
      <center><b>Figure 1</b>: Representación gráfica de $W(x,a,b)$</center>
    </th>
  </tr>
</table>

<p>La generalización de esta función en dos dimensiones en inmediata,</p>

<script type="math/tex; mode=display">W_{2D}(x,y,x_{min},x_{max},y_{min},y_{max}) = W(x,x_{min},x_{max})*W(x,y_{min},y_{max})</script>

<p>De esta forma dado $(x_{min}, x_{max}, y_{min}, y_{max})$, obtenemos la función característica dependiente solo de la posición de un solo punto.</p>

<table>
  <tr>
    <th>
      <video controls="" width="100%" src="http://localhost:4000/DyCon-Blog/assets/imgs/WP05/P0011/BMatrix_Motion.mp4"> </video>
    </th>
  </tr>
  <tr>
    <th>
      <center><b>Video 3: Representación gráfica de</b>  $W_{2D}$</center>
    </th>
  </tr>
</table>

<h2 id="construcción-de-la-dinámica">Construcción de la dinámica</h2>

<p>Para el sistema con memoria (Equation \ref{heatinterior_memory}), podemos introducir una nueva variable, $z(x,t)$ tal que:</p>

<script type="math/tex; mode=display">z(x) = \int_0^t u(x,\tau) d\tau \Rightarrow \dot{z} = u(x,t)</script>

<p>De esta manera el sistema con memoria se convierte en un sistema acoplado de PDEs:</p>

<script type="math/tex; mode=display">% <![CDATA[
\label{heatinterior_memory_z}
\begin{equation}
\begin{cases}
\begin{matrix}
  \dot{u} = \Delta u + f(x,t) \chi_{\omega} + z  &     \dot{z} = u        & \textbf{x} \in \Omega & t \in [0,T] \\
  u(\textbf{x,t}) = u_0                        &  z(\textbf{x,t}) = 0   & \textbf{x} \in \partial \Omega  &  t \in [0,T] \\
  u(\textbf{x},0) = 0                      &  z(\textbf{x},0) = 0   & \textbf{x} \in \Omega 
  \end{matrix}
\end{cases}
\end{equation} %]]></script>

<p>Dado que $\chi_{\omega}$ puede moverse, y ademas que queremos obtener la trayectoria óptima para el control móvil añadiremos al sistema una partícula que puede moverse en dos dimensiones, su posición vendrá denotada por, $\textbf{d} = (d_x,d_y)$, y su velocidad, $\textbf{v} = (v_x,v_y)$. Además añadiremos un control $\textbf{g}(t) = (g_x(t),g_y(t))$ que actuará como una fuerza que moverá el subconjunto $\chi_{\omega}$.</p>

<p>Entonces, el sistema total queda como:</p>

<script type="math/tex; mode=display">% <![CDATA[
\label{heatinterior_memory_z_all}
\begin{equation}
\begin{cases}
\begin{matrix}
  \dot{u} = \Delta u + f(x,t) \chi_{\omega(\textbf{d})} + z  &     \dot{z} = u        & \textbf{x} \in \Omega & t \in [0,T] \\
  u(\textbf{x,t}) = u_0                        &  z(\textbf{x,t}) = 0   & \textbf{x} \in \partial \Omega  &  t \in [0,T] \\
  u(\textbf{x},0) = 0                      &  z(\textbf{x},0) = 0   & \textbf{x} \in \Omega \\
    \dot{\textbf{d}} = \textbf{v} & \textbf{d}(0) = \textbf{d}_0    & t \in [0,T]\\
  \dot{\textbf{v}} = \textbf{g}(t)  & \textbf{v}(0) = \textbf{v}_0  & t \in [0,T]\\
  \end{matrix}
\end{cases}
\end{equation} %]]></script>

<h2 id="numerical-implementation">Numerical Implementation</h2>

<p>En este tutorial necesitaremos DyCon Toolbox, y CasADi. Dado que CasADi es una dependecia de DyCon Toolbox, podemos instalarlo de la siguiente forma</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">unzip</span><span class="p">(</span><span class="s1">'https://github.com/DeustoTech/DyCon-Computational-Platform/archive/master.zip'</span><span class="p">)</span>
<span class="nb">addpath</span><span class="p">(</span><span class="nb">genpath</span><span class="p">(</span><span class="nb">fullfile</span><span class="p">(</span><span class="nb">cd</span><span class="p">,</span><span class="s1">'DyCon-toolbox-master'</span><span class="p">))</span>
<span class="n">StartDyconPlatform</span>
</code></pre></div></div>

<p>Podemos escribir la ecuación \ref{heatinterior_memory_z_all}, en su forma discreta:</p>

<script type="math/tex; mode=display">% <![CDATA[
\label{heatinterior_memory_z_all_discr}
\begin{equation}
\frac{d}{dt} \begin{bmatrix}\begin{array}{c|c}
\textbf{U} \\
\hline
\textbf{Z} \\
\hline
\textbf{D} \\
\hline
\textbf{V} \\
\end{array}
\end{bmatrix}
=
\begin{bmatrix}\begin{array}{c|c|c}
\mathcal{A} & \textbf{1} & \textbf{0} & \textbf{0} \\
\hline
\textbf{1} & \textbf{0}  & \textbf{0} & \textbf{0} \\
\hline
\textbf{0} & \textbf{0}  & \textbf{0} & \textbf{1} \\
\hline
\textbf{0} & \textbf{0}  & \textbf{0} & \textbf{0} \\
\end{array}
\end{bmatrix}
%%
\begin{bmatrix}\begin{array}{c|c}
\textbf{U} \\
\hline
\textbf{Z} \\
\hline
\textbf{D} \\
\hline
\textbf{V} \\
\end{array}
\end{bmatrix}
+
%%
\begin{bmatrix}\begin{array}{c|c}
\textbf{B}(\textbf{D})*\textbf{F}(t) \\
\hline
\textbf{0} \\
\hline
\textbf{0} \\
\hline
\textbf{G}(t) \\
\end{array}
\end{bmatrix}
\end{equation} %]]></script>

<p>Creamos las variables de mesh</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">% Create the mesh variables</span>
<span class="nb">clear</span><span class="p">;</span>
<span class="n">Ns</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="n">Nt</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
<span class="nb">xline</span> <span class="o">=</span> <span class="nb">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Ns</span><span class="p">);</span>
<span class="nb">yline</span> <span class="o">=</span> <span class="nb">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Ns</span><span class="p">);</span>
<span class="p">[</span><span class="n">xms</span><span class="p">,</span><span class="n">yms</span><span class="p">]</span> <span class="o">=</span> <span class="nb">meshgrid</span><span class="p">(</span><span class="nb">xline</span><span class="p">,</span><span class="nb">yline</span><span class="p">);</span>
</code></pre></div></div>

<p>Creamos la matriz A, que contiene el laplaciano en 2D y la dinámica del control movil</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">A</span>  <span class="o">=</span> <span class="n">FDLaplacial2D</span><span class="p">(</span><span class="nb">xline</span><span class="p">,</span><span class="nb">yline</span><span class="p">);</span>

<span class="n">Atotal</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>
<span class="c1">%</span>
<span class="n">Atotal</span><span class="p">(</span> <span class="mi">1</span><span class="p">:</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span> <span class="p">)</span> <span class="o">=</span> <span class="n">A</span><span class="p">;</span>
<span class="c1">%</span>
<span class="n">Atotal</span><span class="p">(</span> <span class="n">Ns</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span><span class="o">*</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span>   <span class="p">,</span>   <span class="mi">1</span>    <span class="p">:</span>  <span class="n">Ns</span><span class="o">^</span><span class="mi">2</span>   <span class="p">)</span>  <span class="o">=</span>  <span class="nb">eye</span><span class="p">(</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span><span class="p">);</span>
<span class="n">Atotal</span><span class="p">(</span>    <span class="mi">1</span>   <span class="p">:</span>  <span class="n">Ns</span><span class="o">^</span><span class="mi">2</span>    <span class="p">,</span> <span class="n">Ns</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span><span class="o">*</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span>  <span class="p">)</span>  <span class="o">=</span>  <span class="mi">50</span><span class="o">*</span><span class="nb">eye</span><span class="p">(</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span><span class="p">);</span> <span class="c1">% z = 50*y</span>

<span class="n">RumbaMatrixDynamics</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">;</span> <span class="k">...</span>
                       <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">;</span> <span class="k">...</span>
                       <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span> <span class="k">...</span>
                       <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="p">];</span>

             
<span class="n">Atotal</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="p">)</span> <span class="o">=</span> <span class="n">RumbaMatrixDynamics</span><span class="p">;</span>
<span class="n">Atotal</span> <span class="o">=</span> <span class="nb">sparse</span><span class="p">(</span><span class="n">Atotal</span><span class="p">);</span>
</code></pre></div></div>

<p>Greamos la función $B(\textbf{d}) = B(x_d,y_d)$</p>
<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">%%</span>
<span class="c1">% We create the B() function </span>
<span class="n">xwidth</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">;</span>
<span class="n">ywidth</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">;</span>
<span class="n">B</span> <span class="o">=</span> <span class="o">@</span><span class="p">(</span><span class="n">xms</span><span class="p">,</span><span class="n">yms</span><span class="p">,</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">)</span> <span class="n">WinWP05</span><span class="p">(</span><span class="n">xms</span><span class="p">,</span><span class="n">xs</span><span class="p">,</span><span class="n">xwidth</span><span class="p">)</span><span class="o">.*</span><span class="n">WinWP05</span><span class="p">(</span><span class="n">yms</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">ywidth</span><span class="p">);</span>
<span class="n">Bmatrix</span> <span class="o">=</span>  <span class="o">@</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">)</span> <span class="p">[</span><span class="nb">diag</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">(</span><span class="n">xms</span><span class="p">,</span><span class="n">yms</span><span class="p">,</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span><span class="p">))</span> <span class="p">;</span><span class="nb">zeros</span><span class="p">(</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span><span class="p">)];</span>
</code></pre></div></div>

<script type="math/tex; mode=display"></script>

<h2 id="optimal-control-problem">Optimal Control Problem</h2>

<script type="math/tex; mode=display">\min_{f(x,t),g(t)}  \int_{\Omega} ||u(x,T) ||^2dx \\</script>

<script type="math/tex; mode=display">% <![CDATA[
\text{subject to: }\begin{cases}
\begin{matrix}
  \dot{u} = \Delta u + f(x,t) \chi_{\omega(\textbf{d})} + z  &     \dot{z} = u        & \textbf{x} \in \Omega & t \in [0,T] \\
  u(\textbf{x,t}) = u_0                        &  z(\textbf{x,t}) = 0   & \textbf{x} \in \partial \Omega  &  t \in [0,T] \\
  u(\textbf{x},0) = 0                      &  z(\textbf{x},0) = 0   & \textbf{x} \in \Omega \\
    \dot{\textbf{d}} = \textbf{v} & \textbf{d}(0) = \textbf{d}_0    & t \in [0,T]\\
  \dot{\textbf{v}} = \textbf{g}(t)  & \textbf{v}(0) = \textbf{v}_0  & t \in [0,T]\\
  \end{matrix}
\end{cases} %]]></script>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">opti</span> <span class="o">=</span> <span class="n">casadi</span><span class="o">.</span><span class="n">Opti</span><span class="p">();</span>  <span class="c1">% CasADi optimization structure</span>

<span class="c1">% ---- Input variables ---------</span>
<span class="n">Ucas</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="c1">% state trajectory</span>
<span class="n">Fcas</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="n">Ns</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>   <span class="c1">% control</span>

<span class="c1">% ---- Dynamic constraints --------</span>
<span class="n">dUdt</span> <span class="o">=</span> <span class="o">@</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">f</span><span class="p">)</span> <span class="n">Atotal</span><span class="o">*</span><span class="n">u</span><span class="o">+</span> <span class="p">[</span><span class="n">Bmatrix</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="k">end</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span><span class="n">u</span><span class="p">(</span><span class="k">end</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="p">;</span> <span class="k">...</span>
                                         <span class="mi">0</span>                     <span class="p">;</span> <span class="k">...</span>
                                         <span class="mi">0</span>                     <span class="p">;</span> <span class="k">...</span>
                                     <span class="n">f</span><span class="p">(</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>                  <span class="p">;</span> <span class="k">...</span>
                                     <span class="n">f</span><span class="p">(</span><span class="k">end</span><span class="p">)</span>                    <span class="p">];</span> 

<span class="c1">% -----Euler backward method-------</span>
<span class="k">for</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">Nt</span> <span class="c1">% loop over control intervals</span>
   <span class="n">y_next</span> <span class="o">=</span> <span class="n">Ucas</span><span class="p">(:,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">T</span><span class="p">/</span><span class="n">Nt</span><span class="p">)</span><span class="o">*</span><span class="n">dUdt</span><span class="p">(</span><span class="n">Ucas</span><span class="p">(:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">dUdt</span><span class="p">(:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span> 
   <span class="n">opti</span><span class="o">.</span><span class="n">subject_to</span><span class="p">(</span><span class="n">Ucas</span><span class="p">(:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="n">y_next</span><span class="p">);</span> <span class="c1">% close the gaps</span>
<span class="k">end</span>

<span class="c1">% ---- State constraints --------</span>
<span class="n">opti</span><span class="o">.</span><span class="n">subject_to</span><span class="p">(</span><span class="n">Ucas</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Y0</span> <span class="p">;</span> <span class="mf">0.7</span> <span class="p">;</span> <span class="mf">0.7</span><span class="p">;</span> <span class="o">-</span><span class="mf">1.5</span> <span class="p">;</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">]);</span>

<span class="c1">% ---- Optimization objective  ----------</span>
<span class="n">Cost</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ucas</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">'*</span><span class="p">(</span><span class="n">Ucas</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>

<span class="n">opti</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">Cost</span><span class="p">);</span> <span class="c1">% minimizing L2 at the final time</span>

<span class="c1">% ---- initial guesses for solver ---</span>
<span class="n">opti</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="n">Ucas</span><span class="p">,</span> <span class="n">Unum_free</span><span class="p">);</span>
<span class="n">opti</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="n">Fcas</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">% ---- solve NLP              ------</span>
<span class="n">p_opts</span> <span class="o">=</span> <span class="nb">struct</span><span class="p">(</span><span class="s1">'expand'</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
<span class="n">s_opts</span> <span class="o">=</span> <span class="nb">struct</span><span class="p">(</span><span class="s1">'acceptable_tol'</span><span class="p">,</span><span class="mf">1e-4</span><span class="p">,</span><span class="s1">'constr_viol_tol'</span><span class="p">,</span><span class="mf">1e-3</span><span class="p">,</span><span class="s1">'compl_inf_tol'</span><span class="p">,</span><span class="mf">1e-3</span><span class="p">);</span>
<span class="n">opti</span><span class="o">.</span><span class="n">solver</span><span class="p">(</span><span class="s1">'ipopt'</span><span class="p">,</span><span class="n">p_opts</span><span class="p">,</span><span class="n">s_opts</span><span class="p">);</span> <span class="c1">% set numerical backend</span>
<span class="nb">tic</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">solve</span><span class="p">();</span>   <span class="c1">% actual solve</span>
<span class="nb">toc</span>
</code></pre></div></div>

<p>Mvil Control</p>

<table>
<tr>
  <th>
    <center>
      <video controls="" width="90%" src="http://localhost:4000/DyCon-Blog/assets/imgs/WP05/P0011/MovilControl.mp4"> </video>
    </center>
  </th>
</tr>
<tr>
<th>
<center><b>Video 3</b></center>
</th>
</tr>
</table>

        <hr>
      </div>
    </div>
  </div>
</article>
<hr>

    <!-- Footer -->
<footer>
  <hr>
  <div class="container">
    <div class="row">
      <ul class="list-inline text-center">
        <li style="margin-right: 50px;">
          <img style="width: 250px;" src="/DyCon-Blog/img/logos/logo_DyCon.png " alt="">
        </li>
        <li style="padding-bottom: 5px;">
          <img style="width: 230px;" src="/DyCon-Blog/img/logos/logo_CCM_subDerecha_v002.png " alt="">
        </li>
      </ul>
    </div>
  </div>
</footer>

</body>
</html>
