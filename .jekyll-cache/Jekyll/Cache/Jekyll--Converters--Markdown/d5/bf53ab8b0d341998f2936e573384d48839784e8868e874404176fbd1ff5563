I"u<p>In this work we solve the optimal control problem</p>

<p align="center">
  <img src="https://latex.codecogs.com/gif.latex?%5Cmin%20_%7Bu%20%5Cin%20L%5E2%20%5Cleft%28%20%5COmega%20%5Cright%29%7D%20%5Cmathcal%7BJ%7D%5Cleft%28%20u%5Cright%29%20%3D%20%5Cmin%20_%7Bu%20%5Cin%20L%5E2%20%5Cleft%28%20%5COmega%20%5Cright%29%7D%20%5Cfrac%7B1%7D%7B2%7D%20%5Cint_%7B%5COmega%7D%20%5Cleft%28%20y%20-%20y_d%20%5Cright%29%20%5E2%20%5Cmathrm%7Bd%7D%20%5COmega%20&plus;%20%5Cfrac%7B%5Cbeta%7D%7B2%7D%20%5Cint_%7B%5COmega%7D%20u%20%5E2%20%5Cmathrm%7Bd%7D%20%5COmega%2C" />
</p>

<p>where <img src="https://latex.codecogs.com/gif.latex?u" /> is the control variable, <img src="https://latex.codecogs.com/gif.latex?y" /> the state variable and <img src="https://latex.codecogs.com/gif.latex?y_d" /> a target function. The minimization problem is subject to the elliptic partial differential equation</p>

<p align="center">
    <img src="https://latex.codecogs.com/gif.latex?%5Cbegin%7Bcases%7D%20-%5CDelta%20y%20%3D%20f%20&plus;%20u%20%26%20%5Ctext%7Bin%20%7D%20%5COmega%2C%20%5C%5C%20y%20%3D%200%20%26%20%5Ctext%7Bon%20%7D%20%5CGamma.%20%5Cend%7Bcases%7D" />
</p>

<p>We use the steepest descent method based on the adjoint methodology. The corresponding adjoint system writes as</p>

<p align="center">
    <img src="https://latex.codecogs.com/gif.latex?%5Cbegin%7Bcases%7D%20-%20%5CDelta%20%5Clambda%20%3D%20y%20-%20y_d%20%26%20%5Ctext%7Bin%20%7D%20%5COmega%2C%20%5C%5C%20%5Clambda%20%3D%200%20%26%20%5Ctext%7Bon%20%7D%20%5CGamma.%20%5Cend%7Bcases%7D" />
</p>

<p>The directional derivative of the cost function is given by</p>

<p align="center">
    <img src="https://latex.codecogs.com/gif.latex?%5Cmathcal%7BD%7D_%7B%20%5Cdelta%20u%7D%20%5Cmathcal%7BJ%7D%20%5Cleft%28%20u%20%5Cright%29%20%3D%20%5Cint_%7B%5COmega%7D%20%5Cleft%28%20%5Clambda%20&plus;%20%5Cbeta%20u%20%5Cright%29%20%5Cdelta%20u%20%5C%2C%20%5Cmathrm%7Bd%7D%20%5COmega%2C" />
</p>

<p>and the control variable is updated according to</p>

<p align="center">
    <img src="https://latex.codecogs.com/gif.latex?u%5E%7B%5Cleft%28%20n%20&plus;%201%20%5Cright%29%7D%20%3D%20u%5E%7B%5Cleft%28%20n%20%5Cright%29%7D%20-%20%5Cepsilon%20%5Cleft%28%20%5Clambda%5E%7B%5Cleft%28%20n%20%5Cright%29%7D%20&plus;%20%5Cbeta%20u%5E%7B%5Cleft%28%20n%20%5Cright%29%7D%20%5Cright%29%2C" />
</p>

<p>for some value of <img src="https://latex.codecogs.com/gif.latex?%5Cepsilon" />.</p>

<h2 id="getting-started">Getting Started</h2>

<p>The solver must be compiled in the terminal. It is advisable to first clean previous compilations with</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wclean
</code></pre></div></div>

<p>and then use</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmake
</code></pre></div></div>

<h3 id="prerequisites">Prerequisites</h3>

<p>OpenFOAM C++ library must be installed in order to compile the code.</p>

<p>The OpenFOAM distribution provided by the <a href="https://openfoam.org/">OpenFOAM Foundation</a> was used.</p>

<h2 id="running-a-case">Running a Case</h2>

<p>In order to run the solver move to the case folder <em>poissonAdjoinFoamCase</em> and type in the command line</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./Allprepare

poissonAdjointFoam
</code></pre></div></div>

<p>The <em>poissonAdjointFoam</em> solver has been tested in a square domain <img src="https://latex.codecogs.com/gif.latex?%5B0%2C%201%5D%20%5Ctimes%20%5B0%2C%201%5D" /> with zero Dirichlet boundary conditions and <img src="https://latex.codecogs.com/gif.latex?%5Cbeta%20%3D%2010%5E%7B-3%7D%2C10%5E%7B-4%7D%2C10%5E%7B-5%7D%2C10%5E%7B-6%7D" />. The target function is <img src="https://latex.codecogs.com/gif.latex?y_d%20%3D%20xy%20%5Csin%20%5Cleft%28%20%5Cpi%20x%20%5Cright%29%20%5Csin%20%5Cleft%28%20%5Cpi%20y%20%5Cright%29" />.</p>

<p align="center">
   <a href="https://github.com/ChairOfComputationalMathematics/poissonAdjointFoam/blob/master/poissonAdjointFoamCase/sd_J.png" target="_blank"><img src="https://github.com/ChairOfComputationalMathematics/poissonAdjointFoam/blob/master/poissonAdjointFoamCase/sd_J.png?raw=true" /></a>
</p>

<p align="center">
   <a href="https://github.com/ChairOfComputationalMathematics/poissonAdjointFoam/blob/master/poissonAdjointFoamCase/sd_Jy.png" target="_blank"><img src="https://github.com/ChairOfComputationalMathematics/poissonAdjointFoam/blob/master/poissonAdjointFoamCase/sd_Jy.png?raw=true" /></a>
</p>

<h3 id="warning">Warning</h3>

<p>It might be needed to use</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sed -i -e 's/\r$//' filename
</code></pre></div></div>

<p>and</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chmod +x filename
</code></pre></div></div>

<p>in order to be able to execute</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./filename
</code></pre></div></div>

<h2 id="references">References</h2>

<ul>
  <li>F. Tr√∂ltzsch. <em>Optimal control of partial differential equations: theory, methods, and applications</em>. American Mathematical Soc., 2010.</li>
</ul>
:ET